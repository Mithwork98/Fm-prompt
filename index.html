<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>De-Identified H&P Prompt Builder</title>
<style>
body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial; margin:16px; max-width:900px; }
h1 { margin-bottom:8px; }
label { display:block; margin-top:12px; font-weight:600; }
input, textarea, select { width:100%; padding:8px; font-size:14px; box-sizing:border-box; margin-top:4px; }
.row { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.half { flex:1 1 48%; }
button { padding:8px 12px; font-size:14px; cursor:pointer; margin-top:10px; }
pre { white-space:pre-wrap; background:#f2f2f4; padding:10px; max-height:600px; overflow:auto; margin-top:8px; border:1px solid #ddd; }
.hint { background:#f6f6f8; padding:10px; border-left:4px solid #ccc; margin-top:8px; }
small { color:#555; display:block; margin-top:6px; }
</style>
</head>
<body>

<h1>H&P Prompt Builder â€” De-identified</h1>
<div class="hint">
<strong style="color:crimson;">Do NOT enter patient identifiers.</strong> This tool runs locally and does not send data anywhere.
</div>

<div class="row">
  <div class="half">
    <label>Age</label>
    <input id="age" placeholder="e.g., 60">
  </div>
  <div class="half">
    <label>Sex</label>
    <select id="sex">
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
  </div>
</div>

<label>Chief Complaint</label>
<input id="cc" placeholder="Patient's own words">

<label>HPI</label>
<textarea id="hpi" rows="4"></textarea>

<label>Past Medical History</label>
<textarea id="pmh" rows="2" placeholder="One per line, e.g. Hypertension, Diabetes"></textarea>

<label>Past Surgical History</label>
<textarea id="psh" rows="2"></textarea>

<label>Medications</label>
<textarea id="meds" rows="3" placeholder="dose/frequency and link to diagnosis"></textarea>

<label>Allergies</label>
<input id="allergies">

<label>Vitals</label>
<input id="vitals" placeholder="BP, HR, Temp, BMI">

<label>Focused Exam</label>
<textarea id="exam" rows="2"></textarea>

<label>Additional Clarifications</label>
<textarea id="additional" rows="3"></textarea>

<div class="row">
  <div class="half">
    <label>Note Output</label>
    <select id="noteType">
      <option value="full">Full H&P</option>
      <option value="sap">Subjective + Assessment/Plan only</option>
    </select>
  </div>
  <div class="half">
    <label><input type="checkbox" id="icd" checked> Include ICD-10</label>
  </div>
</div>

<div>
  <button onclick="buildPrompt()">Build Prompt</button>
  <button onclick="copyPrompt()">Copy Prompt</button>
  <button onclick="clearAll()">Clear</button>
</div>

<label>Preview: Prompt to paste into ChatGPT</label>
<pre id="promptPreview"></pre>

<script>
const getField = id => document.getElementById(id).value.trim() || "Not reported";

// Preventive care auto-fill
function getPreventive(age, sex) {
  let care = [];
  if (age >= 45) care.push("Colon cancer screening (colonoscopy or stool test)");
  if (sex === "Female" && age >= 40) care.push("Mammogram for breast cancer screening");
  if (sex === "Female" && age >= 65) care.push("Bone density scan for osteoporosis");
  if (sex === "Male" && age >= 65) care.push("AAA ultrasound if ever smoked");
  if (age >= 50) care.push("Vaccines: flu shot yearly, shingles vaccine, pneumonia vaccine, COVID-19 boosters, Tdap if due");
  return care.join("; ");
}

// Education pearls based on PMH
function getEducationPearls(pmh) {
  const pearls = [];
  const dx = pmh.toLowerCase();
  pearls.push("Use the latest guidelines for diagnosis and treatment and mention it for each.");

  if (dx.includes("hypertension")) pearls.push("HTN (AHA/ACC 2023): goal BP <130/80 with lifestyle changes and meds as needed.");
  if (dx.includes("diabetes")) pearls.push("Diabetes (ADA 2024): A1c goal <7%, metformin first line, add SGLT2/GLP1 if high CV risk.");
  if (dx.includes("hyperlip")) pearls.push("High cholesterol (ACC/AHA 2023): statin if ASCVD risk >7.5%, LDL goal <70 if ASCVD.");
  if (dx.includes("cad")) pearls.push("Heart disease (AHA 2023): daily aspirin if ASCVD, statin, beta blocker, ACE/ARB.");
  if (dx.includes("ckd")) pearls.push("CKD (KDIGO 2023): control BP, use ACE/ARB, avoid NSAIDs, check labs often.");
  if (dx.includes("copd")) pearls.push("COPD (GOLD 2024): quit smoking, inhalers stepwise, vaccines, pulm rehab.");
  if (dx.includes("asthma")) pearls.push("Asthma (GINA 2024): inhaled steroids preferred, avoid triggers.");
  if (dx.includes("depression")) pearls.push("Depression (APA 2023): CBT + SSRI/SNRI first line, monitor suicide risk.");
  if (dx.includes("osteoporosis")) pearls.push("Osteoporosis (USPSTF 2023): calcium/vit D, weight-bearing exercise, bisphosphonates if needed.");

  return pearls.join("\n- ");
}

function buildPrompt() {
  const inputs = ['age','sex','cc','hpi','pmh','psh','meds','allergies','vitals','exam','additional']
    .reduce((acc, id) => { acc[id] = getField(id); return acc; }, {});
  const icd = document.getElementById('icd').checked ? 'Yes' : 'No';
  const noteType = document.getElementById('noteType').value;
  const preventive = getPreventive(parseInt(inputs.age), inputs.sex);
  const education = getEducationPearls(inputs.pmh);

  let sectionRequest = "";
  if (noteType === "sap") {
    sectionRequest = `
Generate ONLY these sections in very simple English:

SUBJECTIVE:
- Combine chief complaint, HPI, PMH, PSH, Meds, Allergies, and ROS.

ASSESSMENT:
- Problem-oriented list with ICD-10 codes if relevant.
- Use clear, simple wording.

PLAN:
- Short, direct plan for each problem.
- Add lifestyle tips (diet, exercise, sleep, stress).
- Include preventive care gaps: ${preventive}.

EDUCATION:
- ${education}
`;
  } else {
    sectionRequest = `
Generate a full Epic-ready H&P in simple English. 
Include SUBJECTIVE, OBJECTIVE, ASSESSMENT, PLAN, and EDUCATION.
Preventive care gaps: ${preventive}.
EDUCATION section should include:
- ${education}
`;
  }

  const systemPrompt = `
You are a clinical documentation assistant for a Family Medicine physician. 
${sectionRequest}

Constraints:
- Always use clear, simple English (avoid jargon).
- No extra text outside requested sections.
`;

  const userInput = `
PATIENT INPUT:
AGE: ${inputs.age}
SEX: ${inputs.sex}
CHIEF COMPLAINT: ${inputs.cc}
HPI: ${inputs.hpi}
PMH: ${inputs.pmh}
PSH: ${inputs.psh}
MEDICATIONS: ${inputs.meds}
ALLERGIES: ${inputs.allergies}
VITALS: ${inputs.vitals}
EXAM: ${inputs.exam}
ADDITIONAL: ${inputs.additional}
INCLUDE_ICD: ${icd}
END PATIENT INPUT.
`;

  document.getElementById('promptPreview').textContent = systemPrompt + "\n\n" + userInput;
}

function copyPrompt() {
  const text = document.getElementById('promptPreview').textContent;
  if (!text) { alert('Build prompt first'); return; }
  navigator.clipboard.writeText(text).then(() => alert('Copied to clipboard!'));
}

function clearAll() {
  if (!confirm('Clear all fields?')) return;
  ['age','sex','cc','hpi','pmh','psh','meds','allergies','vitals','exam','additional']
    .forEach(id => document.getElementById(id).value='');
  document.getElementById('promptPreview').textContent = '';
}
</script>

</body>
</html>
